{"schemas":"DEFINE TABLE IF NOT EXISTS mosques SCHEMAFULL;\n\nDEFINE FIELD IF NOT EXISTS name ON mosques TYPE string;\nDEFINE FIELD IF NOT EXISTS location ON mosques TYPE geometry<point>;\nDEFINE FIELD IF NOT EXISTS street ON mosques TYPE string;\nDEFINE FIELD IF NOT EXISTS city ON mosques TYPE string;\nDEFINE FIELD IF NOT EXISTS created_at ON mosques TYPE datetime DEFAULT time::now();\nDEFINE FIELD IF NOT EXISTS updated_at ON mosques TYPE datetime DEFAULT time::now();\n\nDEFINE INDEX IF NOT EXISTS mosque_location_idx ON TABLE mosques COLUMNS location MTREE DIMENSION 2;\nDEFINE INDEX IF NOT EXISTS idx_mosque_name ON TABLE mosques COLUMNS name;\nDEFINE INDEX IF NOT EXISTS idx_mosque_city ON TABLE mosques COLUMNS city;\n\nDEFINE TABLE IF NOT EXISTS mosque_details SCHEMAFULL;\n\n-- The mosque these details belong to\nDEFINE FIELD IF NOT EXISTS mosque ON TABLE mosque_details TYPE record<mosques> ASSERT $value != NONE;\n\n-- Array of users who are admins for this mosque\nDEFINE FIELD IF NOT EXISTS admins ON TABLE mosque_details TYPE array<record<users>>;\n\n-- Reference to congregational prayer times record\nDEFINE FIELD IF NOT EXISTS jamat_times ON TABLE mosque_details TYPE record<prayer_times>;\n\n-- Reference to call to prayer times record\nDEFINE FIELD IF NOT EXISTS adhan_times ON TABLE mosque_details TYPE record<prayer_times>;\n\n-- A mosque should have only one details entry\nDEFINE INDEX IF NOT EXISTS idx_mosque_unique ON mosque_details FIELDS mosque UNIQUE;\n\n-- Index for faster lookups by mosque\nDEFINE INDEX IF NOT EXISTS idx_mosque_lookup ON mosque_details FIELDS mosque;\n\nDEFINE TABLE IF NOT EXISTS prayer_times SCHEMAFULL;\n\nDEFINE FIELD IF NOT EXISTS fajr ON TABLE prayer_times TYPE string;\nDEFINE FIELD IF NOT EXISTS dhuhr ON TABLE prayer_times TYPE string;\nDEFINE FIELD IF NOT EXISTS asr ON TABLE prayer_times TYPE string;\nDEFINE FIELD IF NOT EXISTS maghrib ON TABLE prayer_times TYPE string;\nDEFINE FIELD IF NOT EXISTS isha ON TABLE prayer_times TYPE string;\nDEFINE FIELD IF NOT EXISTS jummah ON TABLE prayer_times TYPE string;\nDEFINE FIELD IF NOT EXISTS created_at ON TABLE prayer_times TYPE datetime DEFAULT time::now();\nDEFINE FIELD IF NOT EXISTS updated_at ON TABLE prayer_times TYPE datetime DEFAULT time::now();\n\nDEFINE TABLE OVERWRITE script_migration SCHEMAFULL\n    PERMISSIONS\n        FOR select FULL\n        FOR create, update, delete NONE;\n\nDEFINE FIELD OVERWRITE script_name ON script_migration TYPE string;\nDEFINE FIELD OVERWRITE executed_at ON script_migration TYPE datetime VALUE time::now() READONLY;\nDEFINE FIELD OVERWRITE checksum ON script_migration TYPE option<string>;\n\nDEFINE TABLE IF NOT EXISTS sessions SCHEMAFULL;\n\nDEFINE FIELD IF NOT EXISTS user_id ON sessions TYPE record<users>;\nDEFINE FIELD IF NOT EXISTS session_token ON sessions TYPE string;\nDEFINE FIELD IF NOT EXISTS created_at ON sessions TYPE datetime DEFAULT time::now();\nDEFINE FIELD IF NOT EXISTS expires_at ON sessions TYPE datetime;\n\n-- Unique Session Tokens\nDEFINE INDEX IF NOT EXISTS idx_session_token ON TABLE sessions COLUMNS session_token UNIQUE;\n\nDEFINE TABLE IF NOT EXISTS user_identifier SCHEMAFULL;\n\nDEFINE FIELD IF NOT EXISTS user_id ON user_identifier TYPE record<users>;\nDEFINE FIELD IF NOT EXISTS identifier_type ON user_identifier TYPE string ASSERT $value IN ['email', 'mobile'];\nDEFINE FIELD IF NOT EXISTS identifier_value ON user_identifier TYPE string;\nDEFINE FIELD IF NOT EXISTS created_at ON user_identifier TYPE datetime DEFAULT time::now();\nDEFINE FIELD IF NOT EXISTS updated_at ON user_identifier TYPE datetime DEFAULT time::now();\n\n-- Allow only one user per identifier_value globally\nDEFINE INDEX IF NOT EXISTS idx_identifier_value ON TABLE user_identifier COLUMNS identifier_value UNIQUE;\n\n-- Only one identifier of each type per user\nDEFINE INDEX IF NOT EXISTS idx_user_identifier_type ON TABLE user_identifier COLUMNS user_id, identifier_type UNIQUE;\n\nDEFINE TABLE IF NOT EXISTS users SCHEMAFULL;\n\nDEFINE FIELD IF NOT EXISTS password_hash ON users TYPE string\n\tASSERT string::len($value) > 0;\nDEFINE FIELD IF NOT EXISTS role ON users TYPE string\n\tASSERT $value IN ['app_admin', 'mosque_admin', 'educator', 'regular']\n\tDEFAULT 'regular';\nDEFINE FIELD IF NOT EXISTS display_name ON users TYPE string;\nDEFINE FIELD IF NOT EXISTS created_at ON users TYPE datetime DEFAULT time::now();\nDEFINE FIELD IF NOT EXISTS updated_at ON users TYPE datetime DEFAULT time::now();\n","events":"DEFINE EVENT IF NOT EXISTS cleanup_expired_session ON TABLE sessions WHEN $before != NONE THEN (\n\tDELETE sessions WHERE expires_at <= time::now()\n);\n"}