{"schemas":"DEFINE TABLE OVERWRITE script_migration SCHEMAFULL\n    PERMISSIONS\n        FOR select FULL\n        FOR create, update, delete NONE;\n\nDEFINE FIELD OVERWRITE script_name ON script_migration TYPE string;\nDEFINE FIELD OVERWRITE executed_at ON script_migration TYPE datetime VALUE time::now() READONLY;\nDEFINE FIELD OVERWRITE checksum ON script_migration TYPE option<string>;\n\nDEFINE TABLE user SCHEMAFUL;\n\nDEFINE FIELD password_hash ON users TYPE string;\nDEFINE FIELD role ON users TYPE string ASSERT $value IN ['app_admin', 'mosque_admin', 'educator', 'regular'];\nDEFINE FIELD display_name ON users TYPE string;\nDEFINE FIELD created_at ON users TYPE datetime DEFAULT time::now();\nDEFINE FIELD updated_at ON users TYPE datetime DEFAULT time::now();\n\nDEFINE TABLE user_identifier SCHEMAFUL;\n\nDEFINE FIELD user_id ON user_identifier TYPE record<user>;\nDEFINE FIELD identifier_type ON user_identifier TYPE string ASSERT $value IN ['email', 'mobile'];\nDEFINE FIELD identifier_value ON user_identifier TYPE string;\nDEFINE FIELD created_at ON user_identifier TYPE datetime DEFAULT time::now();\nDEFINE FIELD updated_at ON user_identifier TYPE datetime DEFAULT time::now();\n\n-- Allow only one user per identifier_value globally\nDEFINE INDEX idx_identifier_value ON TABLE user_indentifier COLUMNS identifier_value UNIQUE;\n\n-- Only one identifier of each type per user\nDEFINE INDEX idx_user_identifier_type ON TABLE user_identifier COLUMNS user_id, identifier_type UNIQUE;\n","events":""}